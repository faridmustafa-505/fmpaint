<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Havada Paint - Multiplayer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- MediaPipe (S√ºni ƒ∞ntellekt - ∆èl ƒ∞zl…ôm…ô) -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <!-- PeerJS (Video v…ô S…ôs Z…ôngl…ôri √º√ß√ºn) -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

    <!-- Firebase (Sizin Konfiqurasiyanƒ±z) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, onSnapshot, addDoc, serverTimestamp, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Sƒ∞Zƒ∞N FIREBASE KONFƒ∞QURASƒ∞YANIZ
        const firebaseConfig = {
            apiKey: "AIzaSyALBhMZoDFowkTROYa1awwo-3FbvmnJJpQ",
            authDomain: "azesmmpanel0.firebaseapp.com",
            databaseURL: "https://azesmmpanel0-default-rtdb.firebaseio.com",
            projectId: "azesmmpanel0",
            storageBucket: "azesmmpanel0.firebasestorage.app",
            messagingSenderId: "74060568870",
            appId: "1:74060568870:web:5f5aed2cbef031c2c149e7"
        };

        // Firebase Qura≈üdƒ±rƒ±lmasƒ±
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // T…ôtbiqiniz √º√ß√ºn sabit bir ID (M…ôlumatlarƒ± Firestore-da qrupla≈üdƒ±rmaq √º√ß√ºn)
        const appId = 'havada-paint-azesmmpanel0';

        // Qlobal D…ôyi≈ü…ônl…ôr
        let currentUser = null;
        let currentRoomId = null;
        let localPeer = null;
        let localStream = null;
        let myNickname = "Oyun√ßu";
        let myColor = "#" + Math.floor(Math.random()*16777215).toString(16);
        
        let strokes = []; // K…ôtan m…ôlumatlarƒ±
        let players = {}; // Otaqdakƒ± oyun√ßular

        // DOM Elementl…ôri
        const screens = {
            lobby: document.getElementById('lobbyScreen'),
            game: document.getElementById('gameScreen'),
            loading: document.getElementById('loadingScreen'),
            authError: document.getElementById('authErrorScreen')
        };
        const videoGrid = document.getElementById('videoGrid');
        const errorMsg = document.getElementById('errorMsg');
        const roomCodeDisplay = document.getElementById('roomCodeDisplay');

        // K…ôtan Elementl…ôri
        const drawingCanvas = document.getElementById('drawingCanvas');
        const overlayCanvas = document.getElementById('overlayCanvas');
        const drawingCtx = drawingCanvas.getContext('2d', { willReadFrequently: true });
        const overlayCtx = overlayCanvas.getContext('2d');
        const localVideoElement = document.getElementById('localVideo');

        // Al…ôt t…ônziml…ôm…ôl…ôri
        let toolColor = document.getElementById('colorPicker').value;
        let lineWidth = parseInt(document.getElementById('lineWidth').value);
        let currentTool = 'pen'; 
        let isDrawing = false;
        let wasPinching = false;
        let currentPoints = [];
        let startX = 0, startY = 0;
        let canvasWidth = window.innerWidth;
        let canvasHeight = window.innerHeight;

        // √ñl√ß√ºl…ôri t…ôyin edirik
        function resizeCanvas() {
            drawingCanvas.width = canvasWidth;
            drawingCanvas.height = canvasHeight;
            overlayCanvas.width = canvasWidth;
            overlayCanvas.height = canvasHeight;
            redrawAllStrokes();
        }
        window.addEventListener('resize', () => {
            canvasWidth = window.innerWidth;
            canvasHeight = window.innerHeight;
            resizeCanvas();
        });
        resizeCanvas();

        // --- Auth & Lobby Logic ---
        
        // Sizin √∂z Firebase-iniz olduƒüu √º√ß√ºn Anonim Giri≈ü (Anonymous Auth) istifad…ô edirik
        const initAuth = async () => {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Giri≈ü x…ôtasƒ±:", error);
                // X…ôta olduqda y√ºkl…ônm…ô ekranƒ±nƒ± gizl…ôt v…ô x√ºsusi x…ôta ekranƒ±nƒ± g√∂st…ôr
                screens.loading.classList.add('hidden');
                screens.authError.classList.remove('hidden');
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                screens.loading.classList.add('hidden');
                screens.authError.classList.add('hidden');
                screens.lobby.classList.remove('hidden');
            }
        });

        initAuth();

        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.classList.remove('hidden');
            setTimeout(() => errorMsg.classList.add('hidden'), 5000);
        }

        function generateRoomCode() {
            return Math.random().toString(36).substring(2, 6).toUpperCase();
        }

        // K√∂m…ôk√ßi: Firebase kolleksiya yollarƒ±
        const getPlayersRef = (roomId) => collection(db, 'artifacts', appId, 'public', 'data', `room_players_${roomId}`);
        const getStrokesRef = (roomId) => collection(db, 'artifacts', appId, 'public', 'data', `room_strokes_${roomId}`);

        document.getElementById('createRoomBtn').addEventListener('click', async () => {
            const name = document.getElementById('nicknameInput').value.trim();
            if (!name) return showError("L√ºtf…ôn bir l…ôq…ôb daxil edin.");
            myNickname = name;
            
            screens.lobby.classList.add('hidden');
            screens.loading.classList.remove('hidden');
            
            const roomId = generateRoomCode();
            currentRoomId = roomId;

            try {
                // Otaƒüƒ± yarat
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', roomId), {
                    createdAt: serverTimestamp(),
                    host: currentUser.uid
                });
                startGame(roomId);
            } catch (error) {
                console.error("Firestore x…ôtasƒ±:", error);
                showError("Otaq yaradƒ±lmadƒ±. Firestore qaydalarƒ±nƒ± yoxlayƒ±n.");
                screens.loading.classList.add('hidden');
                screens.lobby.classList.remove('hidden');
            }
        });

        document.getElementById('joinRoomBtn').addEventListener('click', async () => {
            const name = document.getElementById('nicknameInput').value.trim();
            const roomId = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            
            if (!name) return showError("L√ºtf…ôn bir l…ôq…ôb daxil edin.");
            if (!roomId) return showError("L√ºtf…ôn otaq kodunu daxil edin.");
            
            screens.lobby.classList.add('hidden');
            screens.loading.classList.remove('hidden');

            try {
                // Otaƒüƒ± yoxla
                const roomSnap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'rooms', roomId));
                if (!roomSnap.exists()) {
                    screens.loading.classList.add('hidden');
                    screens.lobby.classList.remove('hidden');
                    return showError("Bu kodda otaq tapƒ±lmadƒ±!");
                }

                myNickname = name;
                currentRoomId = roomId;
                startGame(roomId);
            } catch (error) {
                showError("Baza il…ô …ôlaq…ô qurulmadƒ±.");
                screens.loading.classList.add('hidden');
                screens.lobby.classList.remove('hidden');
            }
        });

        // --- Game Setup (MediaPipe, WebRTC, Firebase Listeners) ---

        async function startGame(roomId) {
            roomCodeDisplay.textContent = roomId;
            screens.loading.classList.add('hidden');
            screens.game.classList.remove('hidden');

            // 1. Kamera v…ô Mikrofonu al
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                localVideoElement.srcObject = localStream;
            } catch (err) {
                alert("Kamera v…ô Mikrofon icaz…ôsi verilm…ôlidir!");
                return;
            }

            // 2. PeerJS Qura≈üdƒ±rƒ±lmasƒ± (Video Z…ôngl…ôr √º√ß√ºn)
            localPeer = new Peer(currentUser.uid + '-' + Math.random().toString(36).substr(2, 5));
            
            localPeer.on('open', async (peerId) => {
                // Firebase-d…ô √ñz√ºm√ºz√º Otaƒüa …ôlav…ô edirik
                await setDoc(doc(getPlayersRef(roomId), currentUser.uid), {
                    peerId: peerId,
                    nickname: myNickname,
                    color: myColor,
                    x: -1,
                    y: -1
                });

                setupFirebaseListeners(roomId);
                startMediaPipe();
            });

            // G…ôl…ôn z…ôngl…ôr…ô cavab ver
            localPeer.on('call', (call) => {
                call.answer(localStream); // √ñz kameramƒ±zƒ± g√∂nd…ôririk
                call.on('stream', (remoteStream) => {
                    addRemoteVideo(remoteStream, call.peer);
                });
            });
        }

        function addRemoteVideo(stream, peerId) {
            if (document.getElementById(`video-${peerId}`)) return;
            
            const videoContainer = document.createElement('div');
            videoContainer.id = `video-${peerId}`;
            videoContainer.className = "relative w-32 h-32 md:w-40 md:h-40 rounded-xl overflow-hidden shadow-lg border-2 border-gray-600 bg-black";
            
            const video = document.createElement('video');
            video.srcObject = stream;
            video.autoplay = true;
            video.playsInline = true;
            video.className = "w-full h-full object-cover transform scale-x-[-1]";
            
            videoContainer.appendChild(video);
            videoGrid.appendChild(videoContainer);
        }

        function setupFirebaseListeners(roomId) {
            if (!currentUser) return;

            // Oyun√ßularƒ± dinl…ô
            onSnapshot(getPlayersRef(roomId), (snapshot) => {
                let currentPlayersInRoom = [];
                snapshot.forEach(docSnap => {
                    const data = docSnap.data();
                    players[docSnap.id] = data;
                    currentPlayersInRoom.push(docSnap.id);
                    
                    // ∆èg…ôr yeni oyun√ßudursa, ona z…ông et
                    if (docSnap.id !== currentUser.uid && !document.getElementById(`video-${data.peerId}`)) {
                        const call = localPeer.call(data.peerId, localStream);
                        call.on('stream', (remoteStream) => {
                            addRemoteVideo(remoteStream, data.peerId);
                        });
                    }
                });
            }, (error) => console.error("Oyun√ßu dinl…ôm…ô x…ôtasƒ±", error));

            // R…ôsm x…ôtl…ôrini dinl…ô
            onSnapshot(getStrokesRef(roomId), (snapshot) => {
                strokes = [];
                snapshot.forEach(docSnap => {
                    strokes.push(docSnap.data());
                });
                
                // Clear eventi varsa
                if(strokes.some(s => s.type === 'clear')) {
                    strokes = [];
                    clearFirestoreStrokes(roomId); // K√∂hn…ôl…ôri silirik
                }

                strokes.sort((a,b) => a.timestamp - b.timestamp);
                redrawAllStrokes();
            }, (error) => console.error("R…ôsm dinl…ôm…ô x…ôtasƒ±", error));
        }

        async function clearFirestoreStrokes(roomId) {
            const querySnapshot = await getDocs(getStrokesRef(roomId));
            querySnapshot.forEach((docSnap) => {
                deleteDoc(docSnap.ref);
            });
        }

        // --- Drawing Logic ---

        function redrawAllStrokes() {
            drawingCtx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            strokes.forEach(stroke => {
                if (stroke.type === 'clear') return;

                drawingCtx.beginPath();
                drawingCtx.globalCompositeOperation = stroke.tool === 'eraser' ? 'destination-out' : 'source-over';
                drawingCtx.strokeStyle = stroke.tool === 'eraser' ? '#000' : stroke.color;
                drawingCtx.lineWidth = stroke.lineWidth;
                drawingCtx.lineCap = 'round';
                drawingCtx.lineJoin = 'round';

                if (stroke.tool === 'pen' || stroke.tool === 'eraser') {
                    if(stroke.points.length > 0) {
                        drawingCtx.moveTo(stroke.points[0].x * canvasWidth, stroke.points[0].y * canvasHeight);
                        for (let i = 1; i < stroke.points.length; i++) {
                            drawingCtx.lineTo(stroke.points[i].x * canvasWidth, stroke.points[i].y * canvasHeight);
                        }
                    }
                } else {
                    const sx = stroke.points[0].x * canvasWidth;
                    const sy = stroke.points[0].y * canvasHeight;
                    const cx = stroke.points[1].x * canvasWidth;
                    const cy = stroke.points[1].y * canvasHeight;

                    if (stroke.tool === 'line') {
                        drawingCtx.moveTo(sx, sy);
                        drawingCtx.lineTo(cx, cy);
                    } else if (stroke.tool === 'rect') {
                        drawingCtx.rect(sx, sy, cx - sx, cy - sy);
                    } else if (stroke.tool === 'circle') {
                        let r = Math.hypot(cx - sx, cy - sy);
                        drawingCtx.arc(sx, sy, r, 0, 2 * Math.PI);
                    }
                }
                drawingCtx.stroke();
            });
            drawingCtx.globalCompositeOperation = 'source-over';
        }

        function drawShapePreview(sx, sy, cx, cy) {
            overlayCtx.strokeStyle = toolColor;
            overlayCtx.lineWidth = lineWidth;
            overlayCtx.beginPath();
            if (currentTool === 'line') {
                overlayCtx.moveTo(sx, sy);
                overlayCtx.lineTo(cx, cy);
            } else if (currentTool === 'rect') {
                overlayCtx.rect(sx, sy, cx - sx, cy - sy);
            } else if (currentTool === 'circle') {
                let r = Math.hypot(cx - sx, cy - sy);
                overlayCtx.arc(sx, sy, r, 0, 2 * Math.PI);
            }
            overlayCtx.stroke();
        }

        async function saveStrokeToFirebase(strokeData) {
            if (!currentRoomId || !currentUser) return;
            try {
                await addDoc(getStrokesRef(currentRoomId), strokeData);
            } catch(e) { console.error("X…ôtt yadda saxlanmadƒ±:", e); }
        }

        let lastCursorUpdate = 0;
        async function updateLocalCursor(x, y) {
            const now = Date.now();
            if (now - lastCursorUpdate > 100) { 
                lastCursorUpdate = now;
                if(currentRoomId && currentUser) {
                    await setDoc(doc(getPlayersRef(currentRoomId), currentUser.uid), {
                        x: x / canvasWidth, 
                        y: y / canvasHeight
                    }, { merge: true }).catch(e=>{});
                }
            }
        }

        // Al…ôt Paneli Hadis…ôl…ôri
        document.getElementById('colorPicker').addEventListener('input', (e) => toolColor = e.target.value);
        document.getElementById('lineWidth').addEventListener('input', (e) => lineWidth = parseInt(e.target.value));
        
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('bg-blue-600', 'text-white'));
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.add('bg-gray-800', 'text-gray-200'));
                
                const target = e.currentTarget;
                target.classList.remove('bg-gray-800', 'text-gray-200');
                target.classList.add('bg-blue-600', 'text-white');
                currentTool = target.getAttribute('data-tool');
            });
        });

        document.getElementById('clearBtn').addEventListener('click', async () => {
            if(!currentRoomId) return;
            await addDoc(getStrokesRef(currentRoomId), {
                type: 'clear',
                timestamp: Date.now()
            });
        });

        // --- MediaPipe AI Core ---

        function startMediaPipe() {
            const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
            
            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: 1,
                minDetectionConfidence: 0.7,
                minTrackingConfidence: 0.7
            });
            
            hands.onResults(onResults);

            async function processVideo() {
                if (!localVideoElement.paused && !localVideoElement.ended) {
                    await hands.send({image: localVideoElement});
                }
                requestAnimationFrame(processVideo);
            }
            processVideo();
        }

        function onResults(results) {
            overlayCtx.clearRect(0, 0, canvasWidth, canvasHeight);

            // 1. Dig…ôr oyun√ßularƒ±n kursorlarƒ±nƒ± √ß…ôk
            Object.keys(players).forEach(id => {
                if (id !== currentUser.uid) {
                    const p = players[id];
                    if (p.x >= 0 && p.y >= 0) {
                        const px = p.x * canvasWidth;
                        const py = p.y * canvasHeight;
                        
                        overlayCtx.beginPath();
                        overlayCtx.arc(px, py, 8, 0, 2*Math.PI);
                        overlayCtx.fillStyle = p.color;
                        overlayCtx.fill();
                        
                        // L…ôq…ôb
                        overlayCtx.font = "14px Arial font-bold";
                        overlayCtx.fillStyle = "white";
                        overlayCtx.strokeStyle = "black";
                        overlayCtx.lineWidth = 3;
                        overlayCtx.strokeText(p.nickname, px + 15, py + 5);
                        overlayCtx.fillText(p.nickname, px + 15, py + 5);
                    }
                }
            });

            // 2. √ñz …ôlimizi i≈ül…ôyirik
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                const indexTip = landmarks[8];
                const thumbTip = landmarks[4];

                const x = (1 - indexTip.x) * canvasWidth;
                const y = indexTip.y * canvasHeight;
                const tx = (1 - thumbTip.x) * canvasWidth;
                const ty = thumbTip.y * canvasHeight;

                updateLocalCursor(x, y);

                const distance = Math.hypot(x - tx, y - ty);
                const isPinching = distance < (canvasWidth * 0.04);

                if (isPinching && !wasPinching) {
                    startX = x;
                    startY = y;
                    currentPoints = [{x: x/canvasWidth, y: y/canvasHeight}];
                }

                if (isPinching) {
                    if (currentTool === 'pen' || currentTool === 'eraser') {
                        const lastPoint = currentPoints[currentPoints.length-1];
                        const dist = Math.hypot(lastPoint.x - (x/canvasWidth), lastPoint.y - (y/canvasHeight));
                        if(dist > 0.005) { 
                            currentPoints.push({x: x/canvasWidth, y: y/canvasHeight});
                        }

                        drawingCtx.beginPath();
                        drawingCtx.globalCompositeOperation = currentTool === 'eraser' ? 'destination-out' : 'source-over';
                        drawingCtx.moveTo(startX, startY);
                        drawingCtx.lineTo(x, y);
                        drawingCtx.strokeStyle = currentTool === 'eraser' ? 'rgba(0,0,0,1)' : toolColor;
                        drawingCtx.lineWidth = currentTool === 'eraser' ? lineWidth * 2 : lineWidth;
                        drawingCtx.lineCap = 'round';
                        drawingCtx.lineJoin = 'round';
                        drawingCtx.stroke();
                        
                        startX = x;
                        startY = y;
                    } else {
                        drawShapePreview(startX, startY, x, y);
                    }
                } 
                else if (!isPinching && wasPinching) {
                    let strokeData = {
                        tool: currentTool,
                        color: toolColor,
                        lineWidth: currentTool === 'eraser' ? lineWidth * 2 : lineWidth,
                        timestamp: Date.now()
                    };

                    if (currentTool === 'pen' || currentTool === 'eraser') {
                        strokeData.points = currentPoints;
                    } else {
                        strokeData.points = [
                            {x: startX/canvasWidth, y: startY/canvasHeight},
                            {x: x/canvasWidth, y: y/canvasHeight}
                        ];
                    }
                    
                    saveStrokeToFirebase(strokeData);
                    currentPoints = [];
                }

                wasPinching = isPinching;

                overlayCtx.beginPath();
                overlayCtx.arc(x, y, isPinching ? lineWidth : lineWidth + 4, 0, 2 * Math.PI);
                overlayCtx.fillStyle = isPinching ? toolColor : 'rgba(255, 255, 255, 0.5)';
                overlayCtx.fill();
                if (!isPinching) {
                    overlayCtx.lineWidth = 2;
                    overlayCtx.strokeStyle = toolColor;
                    overlayCtx.stroke();
                }
            } else {
                wasPinching = false;
                updateLocalCursor(-1, -1); 
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-white h-screen w-screen overflow-hidden flex flex-col font-sans select-none">

    <!-- X…ôta Bildiri≈ül…ôri -->
    <div id="errorMsg" class="absolute top-4 left-1/2 transform -translate-x-1/2 z-50 bg-red-500 text-white px-6 py-3 rounded-xl shadow-lg font-medium hidden transition-all">
    </div>

    <!-- Firebase Auth X…ôta Ekranƒ± -->
    <div id="authErrorScreen" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 z-50 hidden px-6 text-center">
        <div class="text-red-500 text-6xl mb-4">‚ö†Ô∏è</div>
        <h2 class="text-3xl font-bold text-white mb-4">Firebase "Anonymous Auth" Aktiv Deyil</h2>
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 text-left max-w-lg mb-6 shadow-xl text-gray-300 leading-relaxed text-sm">
            <p class="mb-3 font-semibold text-white">Bu x…ôtanƒ± h…ôll etm…ôk √º√ß√ºn a≈üaƒüƒ±dakƒ±larƒ± edin:</p>
            <ol class="list-decimal pl-5 space-y-2">
                <li><a href="https://console.firebase.google.com" target="_blank" class="text-blue-400 hover:text-blue-300 underline font-medium">Firebase Console</a>-a daxil olun.</li>
                <li>Layih…ônizi <b>(azesmmpanel0)</b> se√ßin.</li>
                <li>Sol menyudan <b>Authentication</b> b√∂lm…ôsin…ô ke√ßin (v…ô ya Build -> Authentication).</li>
                <li><b>Sign-in method</b> tabƒ±na klikl…ôyin.</li>
                <li>Siyahƒ±dan <b>Anonymous</b> se√ßin, <b>Enable</b> edib yadda saxlayƒ±n.</li>
            </ol>
        </div>
        <button onclick="window.location.reload()" class="px-6 py-3 bg-blue-600 hover:bg-blue-500 active:scale-95 text-white rounded-lg font-bold transition shadow-lg flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
            D√ºz…ôltdikd…ôn Sonra S…ôhif…ôni Yenil…ô
        </button>
    </div>

    <!-- 1. LOBBƒ∞ EKRANI -->
    <div id="lobbyScreen" class="absolute inset-0 flex items-center justify-center bg-gray-900 z-40 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] hidden">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-700">
            <h1 class="text-4xl font-extrabold text-center mb-2 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">
                Havada Paint
            </h1>
            <p class="text-gray-400 text-center mb-8 font-medium">Kamera il…ô multiplayer r…ôsm oyunu</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Oyundakƒ± L…ôq…ôbiniz (Nickname)</label>
                    <input type="text" id="nicknameInput" class="w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl focus:outline-none focus:border-blue-500 text-white font-medium" placeholder="M…ôs: R…ôssam...">
                </div>

                <div class="pt-4">
                    <button id="createRoomBtn" class="w-full py-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 rounded-xl font-bold text-lg shadow-lg transform active:scale-95 transition">
                        Yeni Otaq Yarat
                    </button>
                </div>

                <div class="relative flex py-2 items-center">
                    <div class="flex-grow border-t border-gray-600"></div>
                    <span class="flex-shrink-0 mx-4 text-gray-500 text-sm">v…ô ya</span>
                    <div class="flex-grow border-t border-gray-600"></div>
                </div>

                <div class="flex gap-2">
                    <input type="text" id="roomCodeInput" class="flex-1 px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl focus:outline-none focus:border-green-500 text-white font-medium uppercase tracking-widest text-center" placeholder="OTAQ KODU">
                    <button id="joinRoomBtn" class="px-6 py-3 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 rounded-xl font-bold text-lg shadow-lg transform active:scale-95 transition">
                        Qo≈üul
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Y√ºkl…ônm…ô Ekranƒ± -->
    <div id="loadingScreen" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 z-50">
        <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        <h2 class="mt-6 text-xl font-semibold text-white">Sistem…ô qo≈üulur...</h2>
    </div>

    <!-- 2. OYUN EKRANI -->
    <div id="gameScreen" class="absolute inset-0 flex flex-col hidden bg-gray-900">
        
        <!-- √úst ƒ∞dar…ôetm…ô Paneli -->
        <div class="z-30 p-3 bg-gray-800 shadow-xl flex flex-wrap items-center justify-between gap-4 border-b border-gray-700">
            
            <!-- Otaq Kodu -->
            <div class="flex items-center gap-3 bg-gray-900 px-4 py-2 rounded-xl border border-gray-700">
                <span class="text-gray-400 text-sm font-medium">Otaq Kodu:</span>
                <span id="roomCodeDisplay" class="text-xl font-bold text-green-400 tracking-widest select-all">----</span>
            </div>

            <!-- Al…ôtl…ôr Paneli -->
            <div class="flex flex-wrap gap-2 items-center bg-gray-700 p-1.5 rounded-xl">
                <button data-tool="pen" class="tool-btn bg-blue-600 text-white px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    ‚úèÔ∏è Q…ôl…ôm
                </button>
                <button data-tool="eraser" class="tool-btn bg-gray-800 text-gray-200 hover:bg-gray-600 px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    üßΩ Silgi
                </button>
                <button data-tool="line" class="tool-btn bg-gray-800 text-gray-200 hover:bg-gray-600 px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    üìè X…ôtt
                </button>
                <button data-tool="rect" class="tool-btn bg-gray-800 text-gray-200 hover:bg-gray-600 px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    ‚¨ú D√∂rdbucaq
                </button>
                <button data-tool="circle" class="tool-btn bg-gray-800 text-gray-200 hover:bg-gray-600 px-3 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    ‚≠ï Dair…ô
                </button>

                <div class="w-px h-6 bg-gray-500 mx-2"></div>

                <input type="color" id="colorPicker" value="#00ffcc" class="w-8 h-8 rounded cursor-pointer border-none outline-none bg-transparent">
                <input type="range" id="lineWidth" min="2" max="40" value="8" class="cursor-pointer accent-blue-500 w-20">
                
                <button id="clearBtn" class="ml-2 px-3 py-1.5 bg-red-600 hover:bg-red-500 active:scale-95 text-white rounded-lg font-medium transition flex items-center gap-2 text-sm">
                    T…ômizl…ô
                </button>
            </div>
        </div>

        <!-- ƒ∞≈ü Sah…ôsi -->
        <div class="relative flex-1 w-full bg-[#1a1a2e] overflow-hidden" id="workspace">
            <canvas id="drawingCanvas" class="absolute top-0 left-0 w-full h-full z-10 bg-[#1a1a2e]"></canvas>
            <canvas id="overlayCanvas" class="absolute top-0 left-0 w-full h-full z-20 pointer-events-none"></canvas>
            
            <div id="videoGrid" class="absolute bottom-6 right-6 z-30 flex flex-wrap-reverse gap-4 max-w-[50%] justify-end pointer-events-none">
                <div class="relative w-32 h-32 md:w-40 md:h-40 rounded-xl overflow-hidden shadow-2xl border-2 border-blue-500 bg-black">
                    <video id="localVideo" autoplay playsinline muted class="w-full h-full object-cover transform scale-x-[-1]"></video>
                    <div class="absolute bottom-1 left-1 bg-black/50 text-xs px-2 py-1 rounded text-white font-semibold">Siz</div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
